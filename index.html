<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Введите пароль</title>
    <link rel="stylesheet" href="css/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0, user-scalable=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
          rel="stylesheet">
</head>
<body>
    <div class="box">
        <form>
            <div class="password_block">
                <label>
                    <span>
                        Введите пароль:
                    </span>
                    <!-- fixme complexity_min и complexity_middle могут быть не указаны, на этот случай нужно задать значния по-умолчанию ok-->
                    <input
                        required
                        type="password"
                        name="pass"
                        data-complexity_check="1"
                        data-complexity_min="5"
                        data-complexity_middle="13"
                    >
                </label>
                <button type="submit">
                    Отправить
                </button>
            </div>
        </form>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
            integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        let $inputsPassword = $('Input[data-complexity_check="1"]');

        // todo размести тесты рядом с этой функцией, чтобы не потяреляись, вдруг будешь выносить фукнцию в другой файл, про тексты точно забудешь ok
        function getComplexityPassword(password)
        {
            let balls = password.length;
            const regexUpperCase = /([A-Z])/g;
            const regexSymbol = /\W/g;
            const regexLetters = /[A-Za-z]/g;
            const regexNumber = /[0-9]/g;
            // fixme большие буквы в программировании называет верхний регист по английске upper case, переименную ok

            if (password.match(regexUpperCase) !== null) {
                balls = balls + 1;
            }

            if (password.match(regexSymbol) !== null) {
                balls = balls + 1;
            }

            if (password.match(regexLetters) !== null && password.match(regexNumber) !== null) {
                balls = balls + 1;
            }

            return balls;
        }
        // todo используй объект с паролями и сложностями и цикл для текстов, чтобы не повторяться, в тестах это называется data provider ok
        // нужно заменить существующий спосок тестов на цикл for in по объекту с паролями, внутри цикла будет один console.assert
        // @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in
        let data_provider = {
            'Qwerty123%': 13, 'Q': 2, 'wE': 3, 'd!': 3,'fgh': 3,'12f': 4,'1': 1
        };

        for (const password in data_provider) {
            console.assert(getComplexityPassword(password) === data_provider[password], `Некорректный пароль: ${password} сложность ${data_provider[password]}`)
        }

        $inputsPassword.each((index, element) =>
        {
            let $input = $(element);
            let complexityMin = $input.data('complexity_min') ?? 8;
            let complexityMiddle = $input.data('complexity_middle') ?? 12;
            let complexityMax = complexityMiddle + 10;

            if (complexityMin === ''){
                complexityMin = 8;
            }

            if (complexityMiddle === ''){
                complexityMiddle = 12;
            }

            if (complexityMiddle < complexityMin){
                alert('Ошибка: Средний уровень сложности задан меньше минимального')
            }

            $input
                .parent()
                // fixme max не может быть фиксированным он должен рачитываться в зависимости от high например high + 10 ok
                .append(`<meter min="0" low=${complexityMin} high=${complexityMiddle} max=${complexityMax}></meter>`);

            // если блок кода с объявлением переменных и констант соседсвует с другим кодом его нужно отделать пустыми строками, как здесь, исправь в других местах
            let $meter = $input.parent().find('meter');
            let balls = 0;
            let inputPassword = null;

            $input.on('keyup', (event) =>
            {
                let inputVal = $input.val();

                inputPassword = event.currentTarget;
                $meter.css({visibility: 'visible'});
                balls = getComplexityPassword(inputVal);
                $meter.val(String(balls));

                if (balls < $meter.attr('low')) {
                    inputPassword.setCustomValidity('Слабый пароль');
                } else {
                    inputPassword.setCustomValidity('');
                }
            });
        });
    </script>
</body>
</html>